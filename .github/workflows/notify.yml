# ============================================================
# File: .github/workflows/notify.yml
# Project: GSoC 2026 PoC â€” GitHub Actions Ã— Discord Integration
# Author: NOAH DCRUZE
# Description:
#Â  Â Triggers on every push to any branch and sends a
#Â  Â "Hello World" notification to a Discord channel via
#Â  Â webhook. The committer's GitHub username and commit
# messages are included in the embed for context.
# ============================================================

name: ğŸ”” Discord Push Notification

# â”€â”€ Trigger â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 
on:
Â  push:
Â  Â  branches:
Â  Â  Â  - "**"Â  Â # Listen on ALL branches

# â”€â”€ Jobs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
jobs:
Â  notify-discord:
Â  Â  name: Send Hello World to Discord
Â  Â  runs-on: ubuntu-latest

Â  Â  steps:
Â  Â  Â  # Step 1 â€” Check out the code so we can read git metadata
Â  Â  Â  - name: â¬‡ï¸ Checkout repository
Â  Â  Â  Â  uses: actions/checkout@v4

Â  Â  Â  # Step 2 â€” Build and send the Discord webhook payload
Â  Â  Â  #
Â  Â  Â  # We use a Python one-liner so the JSON is easy to
Â  Â  Â  # read and extend. The webhook URL is pulled from
Â  Â  Â  # GitHub Secrets â€” it is NEVER hard-coded here.
Â  Â  Â  #
Â  Â  Â  # Context variables used:
Â  Â  Â  #Â  Â github.actorÂ  Â  Â  Â  â†’ GitHub username of the pusher
Â  Â  Â  #Â  Â github.event.head_commit.message â†’ latest commit msg
Â  Â  Â  #Â  Â github.repositoryÂ  Â â†’ "owner/repo" string
Â  Â  Â  #Â  Â github.ref_nameÂ  Â  Â â†’ branch name
Â  Â  Â  #Â  Â github.shaÂ  Â  Â  Â  Â  â†’ full commit SHA
Â  Â  Â  - name: ğŸ“¨ Notify Discord
Â  Â  Â  Â  env:
Â  Â  Â  Â  Â  # âš ï¸Â  Store your webhook URL in:
Â  Â  Â  Â  Â  #Â  Â  Â Settings â†’ Secrets and variables â†’ Actions
Â  Â  Â  Â  Â  #Â  Â  Â Secret name: DISCORD_WEBHOOK
Â  Â  Â  Â  Â  DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}

Â  Â  Â  Â  Â  # Expose GitHub context as env vars for the script
Â  Â  Â  Â  Â  GH_ACTOR:Â  Â  ${{ github.actor }}
Â  Â  Â  Â  Â  GH_REPO:Â  Â  Â ${{ github.repository }}
Â  Â  Â  Â  Â  GH_BRANCH:Â  Â ${{ github.ref_name }}
Â  Â  Â  Â  Â  GH_SHA:Â  Â  Â  ${{ github.sha }}
Â  Â  Â  Â  Â  GH_MSG:Â  Â  Â  ${{ github.event.head_commit.message }}
Â  Â  Â  Â  Â  GH_REPO_URL: ${{ github.server_url }}/${{ github.repository }}

Â  Â  Â  Â  run: |
Â  Â  Â  Â  Â  python3 - <<'EOF'
Â  Â  Â  Â  Â  import os
Â  Â  Â  Â  Â  import json
Â  Â  Â  Â  Â  import urllib.request
Â  Â  Â  Â  Â  import urllib.error

Â  Â  Â  Â  Â  # â”€â”€ Read environment variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Â  Â  Â  Â  Â  webhook_url = os.environ["DISCORD_WEBHOOK"]
Â  Â  Â  Â  Â  actorÂ  Â  Â  Â = os.environ["GH_ACTOR"]
Â  Â  Â  Â  Â  repoÂ  Â  Â  Â  = os.environ["GH_REPO"]
Â  Â  Â  Â  Â  branchÂ  Â  Â  = os.environ["GH_BRANCH"]
Â  Â  Â  Â  Â  shaÂ  Â  Â  Â  Â = os.environ["GH_SHA"]
Â  Â  Â  Â  Â  commit_msgÂ  = os.environ["GH_MSG"]
Â  Â  Â  Â  Â  repo_urlÂ  Â  = os.environ["GH_REPO_URL"]

Â  Â  Â  Â  Â  short_shaÂ  Â = sha[:7]Â  Â # First 7 chars â€” standard convention
Â  Â  Â  Â  Â  commit_urlÂ  = f"{repo_url}/commit/{sha}"
Â  Â  Â  Â  Â  actor_urlÂ  Â = f"https://github.com/{actor}"
Â  Â  Â  Â  Â  avatar_urlÂ  = f"https://github.com/{actor}.png?size=128"

Â  Â  Â  Â  Â  # â”€â”€ Build the Discord Embed payload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Â  Â  Â  Â  Â  # Discord embeds let us create rich, structured cards.
Â  Â  Â  Â  Â  payload = {
Â  Â  Â  Â  Â  Â  "content": "ğŸ‘‹ **Hello World!** A new push just landed.",
Â  Â  Â  Â  Â  Â  "embeds": [
Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  "title": f"ğŸ“¦ New Push to `{repo}`",
Â  Â  Â  Â  Â  Â  Â  Â  "url": commit_url,
Â  Â  Â  Â  Â  Â  Â  Â  "color": 0x5865F2,Â  Â # Discord Blurple
Â  Â  Â  Â  Â  Â  Â  Â  "author": {
Â  Â  Â  Â  Â  Â  Â  Â  Â  "name": actor,
Â  Â  Â  Â  Â  Â  Â  Â  Â  "url": actor_url,
Â  Â  Â  Â  Â  Â  Â  Â  Â  "icon_url": avatar_url
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  "fields": [
Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "name": "ğŸ‘¤ Pushed by",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "value": f"[{actor}]({actor_url})",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "inline": True
Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "name": "ğŸŒ¿ Branch",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "value": f"`{branch}`",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "inline": True
Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "name": "ğŸ”– Commit",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "value": f"[`{short_sha}`]({commit_url})",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "inline": True
Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "name": "ğŸ’¬ Commit Message",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "value": commit_msg or "_No message provided_",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "inline": False
Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  "footer": {
Â  Â  Â  Â  Â  Â  Â  Â  Â  "text": "GitHub Actions Ã— Discord PoC â€” RUXAILAB GSoC 2026"
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  "thumbnail": {
Â  Â  Â  Â  Â  Â  Â  Â  Â  "url": avatar_url
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  # â”€â”€ Send the HTTP POST request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Â  Â  Â  Â  Â  body = json.dumps(payload).encode("utf-8")
Â  Â  Â  Â  Â  reqÂ  = urllib.request.Request(
Â  Â  Â  Â  Â  Â  Â  webhook_url,
Â  Â  Â  Â  Â  Â  Â  dataÂ  Â  = body,
Â  Â  Â  Â  Â  Â  Â  headers = {"Content-Type": "application/json"},
Â  Â  Â  Â  Â  Â  Â  methodÂ  = "POST"
Â  Â  Â  Â  Â  )

Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  with urllib.request.urlopen(req) as resp:
Â  Â  Â  Â  Â  Â  Â  Â  Â  print(f"âœ… Discord notified â€” HTTP {resp.status}")
Â  Â  Â  Â  Â  except urllib.error.HTTPError as e:
Â  Â  Â  Â  Â  Â  Â  print(f"âŒ Failed to notify Discord â€” HTTP {e.code}: {e.reason}")
Â  Â  Â  Â  Â  Â  Â  raise SystemExit(1)Â  Â # Fail the step so the Action shows red
Â  Â  Â  Â  Â  EOF
